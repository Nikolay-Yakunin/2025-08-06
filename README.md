# Archiver Service

Сервис для архивации файлов по ссылкам. Позволяет создавать задачи, 
добавлять ссылки на файлы и получать архив со скачанными файлами.

## Requirments

Минимальная версия go:
- 1.22.2

Здесь используется библиотека - github.com/google/uuid v1.6.0

Поэтому, установите  зависимости.

```sh
go mod tidy
```

## Обзор проекта

Структура проекта:
```
.
├── cmd
│   └── archiver_service
│       └── main.go        Экземпляр приложения
├── internal
│   ├── actor
│   │   └── actor.go       Паттерн актор
│   ├── archiver
│   │   └── archiver.go    Архиватор
│   ├── downloader
│   │   └── downloader.go  Прокси загрузчик
│   ├── task
│   │   └── task.go        Задачи/таски
│   └── taskmanager
│       └── taskmanager.go Планировщик тасок
├── pkg
│   └── config
│       └── config.go
```
## Использование

### Подготовка

Конфиг имеет дефолтную настройку, 
но если вы желаете сами настроить параметры приложения,
вы можете использовать .env файл для определения переменных окружения.

```.env
# Порт сервера
PORT=:8080

# Максимальное количество одновременных задач
MAX_TASKS=3

# Максимальное количество файлов в одной задаче
MAX_FILES=3

# Максимальный размер файла (в мегабайтах)
MAX_FILE_SIZE_MB=300

# Временная директория для файлов
TMP_PATH=/tmp/archiver/

# Разрешенные расширения файлов
ALLOWED_EXT=.jpg .jpeg .pdf

# Режим работы (debug/production)
MODE=development
```

### Запуск

Для того чтобы запустить экземпляр приложения, вы можете использовать комманду:
```sh
go run cmd/archiver_service
```

Сервер будет доступен по адресу:
```
http://localhost:8080
```

### Примеры запросов

Создать задачу и получить ее uuid.
```sh
curl -X GET http://localhost:8080/task
```

Добавить ссылку в задачу,
нужно добавить TASK_ID, которое мы получили с помощью прошлого запроса. 
```sh
curl -X POST http://localhost:8080/task/<TASK_ID> \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com/file.pdf"}'
```

Получить статус о загрузке,
возможные статусы:
- "pending": Ожидание заполнения пулла,
- "processing": Процесс загрузки файлов и архивации,
- "completed" Загрузка и архивация законченна, 
также возвращает ссылку на скачивание архива,
- "failed" Ошибка в ходе выполнения таски.
```sh
curl -X GET http://localhost:8080/task/<TASK_ID>
```

Загрузка архива.
```sh
curl -O http://localhost:8080/download/<TASK_ID>
```

Я написал готовый скрипт простого теста,
для его запуска:
```sh
bash test.sh
```
Скрипт автоматически: 
- Создает новую задачу
- Добавляет 3 файла для загрузки
- Ожидает завершения архивации
- Скачивает полученный архив
     

Если вы изменили параметры в env, измените их в скрипте.

